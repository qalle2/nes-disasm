clear
rm -f test-out/*.asm test-out/*.bin

# disassemble, reassemble and verify various games

echo "=== all-instructions.prg ==="
python3 nesdisasm.py test-in/all-instructions.prg > test-out/all-instructions.asm
asm6f test-out/all-instructions.asm test-out/all-instructions-reassembled.bin
diff test-in/all-instructions.prg test-out/all-instructions-reassembled.bin
echo

echo "=== anontest.prg ==="
python3 nesdisasm.py test-in/anontest.prg > test-out/anontest.asm
asm6f test-out/anontest.asm test-out/anontest-reassembled.bin
diff test-in/anontest.prg test-out/anontest-reassembled.bin
echo

echo "=== Game Genie ==="
python3 nesdisasm.py --no-absolute-zp --no-absolute-indexed-zp --no-opcodes 00 --no-access 0800-1fff,2008-3fff,4020-7fff --no-execute 2000-401f test-in/gamegenie.prg > test-out/gamegenie.asm
asm6f test-out/gamegenie.asm test-out/gamegenie-reassembled.bin
diff test-in/gamegenie.prg test-out/gamegenie-reassembled.bin
echo

echo "=== Excitebike (use CDL file) ==="
python3 nesdisasm.py --no-absolute-zp --no-absolute-indexed-zp --no-opcodes 00 --no-access 0800-1fff,2008-3fff,4020-bfff --no-execute 2000-401f --no-write 8000-ffff test-in/excitebike.prg --cdl-file ~/nes/cdl/excitebike-ju.cdl > test-out/excitebike.asm
asm6f test-out/excitebike.asm test-out/excitebike-reassembled.bin
diff test-in/excitebike.prg test-out/excitebike-reassembled.bin
echo

echo "=== SMB (use CDL file) ==="
# 00 = BRK, 01/21/41/61/81/a1/c1/e1 = (indirect,x), 11/31/51/71/d1/f1 = (indirect),y excluding LDA/STA
python3 nesdisasm.py --no-absolute-zp --no-absolute-indexed-zp --no-opcodes 00,01,11,21,31,41,51,61,71,81,a1,c1,d1,e1,f1 --no-access 0800-1fff,2008-3fff,4020-7fff --no-execute 2000-401f --no-write 8000-ffff --cdl-file ~/nes/cdl/smb1-w.cdl test-in/smb1.prg > test-out/smb1.asm
asm6f test-out/smb1.asm test-out/smb1-reassembled.bin
diff test-in/smb1.prg test-out/smb1-reassembled.bin
echo

